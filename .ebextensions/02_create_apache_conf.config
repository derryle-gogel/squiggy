#
# Apache configuration files and keys.
#
files:
  /tmp/ssl.conf:
    mode: '000644'
    owner: root
    group: root
    content: |
      <VirtualHost *:80>
        <Proxy *>
          Require all granted
        </Proxy>

        ProxyPreserveHost on

        LogLevel INFO rewrite:trace3
        LogLevel INFO proxy:trace3

        RewriteEngine on
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteRule .* "ws://localhost:8000%{REQUEST_URI}" [P,L]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule .* "ws://localhost:8000%{REQUEST_URI}" [P,L]

        ProxyPass / http://localhost:8000/ retry=0
        ProxyPassReverse / http://localhost:8000/
        ProxyTimeout 3
      </VirtualHost>